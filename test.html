<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNG to WebP - æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: rgba(255,255,255,0.95);
            color: #333;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        h1 { color: #667eea; margin-top: 0; }
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
        }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
        .warning { background: #fef3c7; color: #92400e; }
        code { background: #f3f4f6; padding: 2px 6px; border-radius: 4px; }
        .btn {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin: 5px;
            font-weight: 600;
        }
        .btn:hover { background: #5568d3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¸ PNG è½¬ WebP - éƒ¨ç½²æµ‹è¯•</h1>

        <div id="status"></div>

        <h3>ğŸ“‹ æ£€æŸ¥æ¸…å•</h3>
        <ul id="checklist"></ul>

        <h3>ğŸ”— å¿«é€Ÿé“¾æ¥</h3>
        <div>
            <a href="/" class="btn">ä¸»é¡µ</a>
            <a href="/advanced" class="btn">é«˜çº§è½¬æ¢å™¨</a>
            <a href="/about" class="btn">å…³äºé¡µé¢</a>
        </div>

        <h3>ğŸ”§ éƒ¨ç½²ä¿¡æ¯</h3>
        <div id="info"></div>
    </div>

    <script>
        const status = document.getElementById('status');
        const checklist = document.getElementById('checklist');
        const info = document.getElementById('info');

        function addCheck(text, type) {
            const li = document.createElement('li');
            li.innerHTML = `<span class="status ${type}">${text}</span>`;
            checklist.appendChild(li);
        }

        function setStatus(text, type) {
            status.innerHTML = `<div class="status ${type}">${text}</div>`;
        }

        // æ£€æŸ¥ Canvas æ”¯æŒ
        const canvasSupported = !!window.HTMLCanvasElement;
        addCheck(
            canvasSupported ? 'âœ… Canvas API æ”¯æŒ' : 'âŒ Canvas API ä¸æ”¯æŒ',
            canvasSupported ? 'success' : 'error'
        );

        // æ£€æŸ¥æ–‡ä»¶ API
        const fileSupported = !!window.File && !!window.FileReader;
        addCheck(
            fileSupported ? 'âœ… æ–‡ä»¶ API æ”¯æŒ' : 'âŒ æ–‡ä»¶ API ä¸æ”¯æŒ',
            fileSupported ? 'success' : 'error'
        );

        // æ£€æŸ¥ç°ä»£æµè§ˆå™¨
        const modernBrowser = 'FileReader' in window && 'Blob' in window;
        addCheck(
            modernBrowser ? 'âœ… ç°ä»£æµè§ˆå™¨ç‰¹æ€§' : 'âŒ æµè§ˆå™¨è¿‡æ—§',
            modernBrowser ? 'success' : 'error'
        );

        // æ˜¾ç¤ºä¿¡æ¯
        info.innerHTML = `
            <p><strong>æµè§ˆå™¨:</strong> ${navigator.userAgent}</p>
            <p><strong>å½“å‰æ—¶é—´:</strong> ${new Date().toLocaleString()}</p>
            <p><strong>URL:</strong> ${window.location.href}</p>
            <p><strong>åè®®:</strong> ${window.location.protocol}</p>
        `;

        // å°è¯•è®¿é—®ä¸»é¡µ
        fetch('/')
            .then(res => {
                if (res.ok) {
                    setStatus('âœ… ä¸»é¡µå¯è®¿é—® (HTTP ' + res.status + ')', 'success');
                    addCheck('âœ… ä¸»é¡µåŠ è½½æ­£å¸¸', 'success');
                } else {
                    setStatus('âš ï¸ ä¸»é¡µè¿”å›çŠ¶æ€: ' + res.status, 'warning');
                    addCheck('âš ï¸ ä¸»é¡µçŠ¶æ€å¼‚å¸¸: ' + res.status, 'warning');
                }
            })
            .catch(err => {
                setStatus('âŒ æ— æ³•è®¿é—®ä¸»é¡µ: ' + err.message, 'error');
                addCheck('âŒ ä¸»é¡µè®¿é—®å¤±è´¥', 'error');
            });

        // æµ‹è¯• Canvas è½¬æ¢
        setTimeout(() => {
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = 100;
                canvas.height = 100;
                ctx.fillStyle = '#667eea';
                ctx.fillRect(0, 0, 100, 100);

                canvas.toBlob(blob => {
                    if (blob) {
                        addCheck('âœ… Canvas è½¬æ¢æµ‹è¯•é€šè¿‡', 'success');
                    } else {
                        addCheck('âŒ Canvas è½¬æ¢å¤±è´¥', 'error');
                    }
                }, 'image/webp');
            } catch (e) {
                addCheck('âŒ Canvas æµ‹è¯•å¼‚å¸¸: ' + e.message, 'error');
            }
        }, 100);
    </script>
</body>
</html>